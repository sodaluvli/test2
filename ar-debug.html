<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>AR: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–∞—Ä–∫–µ—Ä–∞</title>
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.3/aframe/build/aframe-ar.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
        
        .debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .debug-panel h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #4CAF50;
        }
        
        .debug-line {
            margin: 5px 0;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        
        .back-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #8B1538;
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            z-index: 1000;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="debug-panel" id="debug">
        <h3>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AR</h3>
        <div id="debug-log"></div>
    </div>
    
    <a href="gallery.html" class="back-btn">–ù–∞–∑–∞–¥ –≤ –≥–∞–ª–µ—Ä–µ—é</a>

    <!-- –°—Ü–µ–Ω–∞ —Å –≤–∫–ª—é—á–µ–Ω–Ω–æ–π –æ—Ç–ª–∞–¥–∫–æ–π -->
    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;">
        
        <a-assets>
            <a-asset-item id="model" src="sample.glb"></a-asset-item>
        </a-assets>

        <!-- –ú–∞—Ä–∫–µ—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <a-marker 
            type="pattern" 
            url="pattern-efra.patt" 
            id="marker"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5"
            emitevents="true">
            
            <!-- –ü—Ä–æ—Å—Ç–æ–π –∫—É–± –¥–ª—è —Ç–µ—Å—Ç–∞ (–µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è) -->
            <a-box 
                position="0 0.5 0" 
                material="color: red;" 
                scale="0.5 0.5 0.5"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 3000">
            </a-box>
            
            <!-- 3D –º–æ–¥–µ–ª—å -->
            <a-entity 
                id="model-entity"
                gltf-model="#model" 
                position="0 0 0" 
                scale="0.5 0.5 0.5"
                visible="true">
            </a-entity>
            
            <!-- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ -->
            <a-light type="point" intensity="2" position="0 2 0"></a-light>
            
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const debugLog = document.getElementById('debug-log');
        const marker = document.getElementById('marker');
        const modelEntity = document.getElementById('model-entity');
        
        function log(message, type = 'info') {
            const line = document.createElement('div');
            line.className = `debug-line ${type}`;
            line.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            debugLog.insertBefore(line, debugLog.firstChild);
            console.log(message);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
            if (debugLog.children.length > 10) {
                debugLog.removeChild(debugLog.lastChild);
            }
        }

        window.addEventListener('load', () => {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å—Ü–µ–Ω—ã
            const scene = document.querySelector('a-scene');
            if (scene) {
                scene.addEventListener('loaded', () => {
                    log('A-Frame —Å—Ü–µ–Ω–∞ –≥–æ—Ç–æ–≤–∞', 'success');
                });
                
                scene.addEventListener('renderstart', () => {
                    log('AR.js –∑–∞–ø—É—â–µ–Ω, –∫–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞', 'success');
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞—Ä–∫–µ—Ä
            if (marker) {
                log('–ú–∞—Ä–∫–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
                marker.addEventListener('markerFound', () => {
                    log('‚úÖ –ú–ê–†–ö–ï–† –ù–ê–ô–î–ï–ù!', 'success');
                    if ('vibrate' in navigator) navigator.vibrate(200);
                });
                
                marker.addEventListener('markerLost', () => {
                    log('‚ùå –ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω', 'warning');
                });
            } else {
                log('–û—à–∏–±–∫–∞: –º–∞—Ä–∫–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–∏
            if (modelEntity) {
                modelEntity.addEventListener('model-loaded', () => {
                    log('3D –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                });
                
                modelEntity.addEventListener('model-error', (e) => {
                    log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏: ' + e.detail, 'error');
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤
            fetch('pattern-efra.patt')
                .then(response => {
                    if (response.ok) {
                        log('–§–∞–π–ª –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞–π–¥–µ–Ω', 'success');
                    } else {
                        log('–§–∞–π–ª –º–∞—Ä–∫–µ—Ä–∞ –ù–ï –Ω–∞–π–¥–µ–Ω!', 'error');
                    }
                })
                .catch(() => {
                    log('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É –º–∞—Ä–∫–µ—Ä–∞', 'error');
                });
                
            fetch('sample.glb')
                .then(response => {
                    if (response.ok) {
                        log('–§–∞–π–ª 3D –º–æ–¥–µ–ª–∏ –Ω–∞–π–¥–µ–Ω', 'success');
                    } else {
                        log('–§–∞–π–ª 3D –º–æ–¥–µ–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω!', 'error');
                    }
                })
                .catch(() => {
                    log('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É –º–æ–¥–µ–ª–∏', 'error');
                });
        });
        
        // –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –æ—à–∏–±–∫–∏
        window.addEventListener('error', (e) => {
            log('–û—à–∏–±–∫–∞: ' + e.message, 'error');
        });
    </script>
</body>
</html>
